<html>
<head>
	<title>shudu</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">

	tr:{
		border: 1px black solid
	}

	table{
		width:520px;
		 border-collapse:collapse;
	}

	td{
		width: 50px;
		height: 50px;
	}

	input{
		width:50px;
		height: 30px;
		display: none;
	}

	.boundary-left {
	border-left: 3px #000000 solid;
	}

	.boundary-bottom {
	border-bottom: 3px #000000 solid;
	}

	.txt{

	}
	</style>


	<script   src="https://code.jquery.com/jquery-2.2.2.min.js"   integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI="   crossorigin="anonymous"></script>


</head>
<body>
<table border="1px" width="500px" height="500px">
<tr line="0">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="1">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>


<tr class="boundary-bottom" line="2">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>


<tr boundary-top line="3">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>



<tr line="4">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr class="boundary-bottom" line="5">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="6">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="7">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="8">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

</table>



<div>
	<p>假设级别<span id="level"></span></p>
</div>
<div>
	<p>
	<button class="level">level1</button>
	<button class="level">level2</button>
	<button class="level">level3</button>
	<button class="level">level4</button>
	<button class="breaklevel">break assumption</button>
	</p>
</div>

<div>
	<p>
	<button class="levelStart">show level1 start point</button>
	<button class="levelStart">show level2 start point</button>
	<button class="levelStart">show level3 start point</button>
	<button class="levelStart">show level4 start point</button>
	<button class="hidelevelStart">hide all level start point</button>
	</p>
</div>
</body>

<script type="text/javascript">

	var defaultColor = "blue"
	var defaultBackColor = "white"

	const LEVEL1COLOR = "#ffffff"
	const LEVEL1BACKCOLOR = "#00FA9A"

	const LEVEL2COLOR = "#ffffff"
	const LEVEL2BACKCOLOR = "#9ACD32"

	const LEVEL3COLOR = "#ffffff"
	const LEVEL3BACKCOLOR = "#FFA500"

	const LEVEL4COLOR = "#ffffff"
	const LEVEL4BACKCOLOR = "#000080"

	$("td").click(function(){
		$(this).find("input").show()
		$(this).find(".txt").hide()

		var txt = $(this).find(".txt").html()
		$(this).find("input").val(dragNumFromtext(txt))
		$(this).find("input").focus()
	})

	$("input").keydown(function(e){
		if(parseInt(e.keyCode)==13){
			var txt = $(this).val()
			addIntoLevelArr($(this).parents("tr").index(),$(this).parents("td").index(),txt)
			$(this).siblings(".txt").text(textManager(txt))
			$(this).siblings(".txt").show()
			$(this).hide()
			$(this).val("")
		}
	})

	$("input").blur(function(){
			var txt = $(this).val()
			addIntoLevelArr($(this).parents("tr").index(),$(this).parents("td").index(),txt)
			$(this).hide()

			if(!txt) return false;

			$(this).siblings(".txt").text(textManager(txt))
			$(this).siblings(".txt").show()
			$(this).val("")
	})

	$(".level").click(function(){
		var levelInt = parseInt($(this).index())

		if(!checklevelJump(levelInt)) return false;

		window.levelInt = levelInt
		showLevel(levelInt)
	})

	$(".levelStart").click(function(){
		var levelInt = parseInt($(this).index())
		var i = orderLevelStartArr[levelInt]["i"]
		var j = orderLevelStartArr[levelInt]["j"]

		if(parseInt(i)>=0 && parseInt(j)>=0 ){
			showStartPoint(i,j,levelInt)
		}
	})

	$(".hidelevelStart").click(function(){
		for(var k=0;k<orderLevelStartArr.length;k++){
				var i = orderLevelStartArr[k]["i"]
				var j = orderLevelStartArr[k]["j"]
		

		if(parseInt(i)>=0 && parseInt(j)>=0 ){
			findElementByIJ(i,j).css("background",defaultBackColor)
			findElementByIJ(i,j).find(".txt").css("color",defaultColor)
		}

		}

	})

	$(".breaklevel").click(function(){
		cancelLevelTo(-1)
		showLevel(-1)
		delete window.levelInt
	})


	function checklevelJump(levelInt){

		if(isNaN(window.levelInt) && levelInt>0){
			alert("you jump to much.");
			return false;
		}

		if(levelInt - window.levelInt>1){
			alert("you jump to much.");
			return false;
		}


		if(levelInt<window.levelInt){
			var confirm = window.confirm("level is now in "+window.levelInt+" if you want to go to level "+levelInt+" you should cancel the level that is larger that "+levelInt)

			if(confirm){
				cancelLevelTo(levelInt)
				return true;
			}else{
				return false;
			}

		}

		return true;

	}

	function showStartPoint(i,j,levelInt){

		findElementByIJ(i,j).css("background",eval("LEVEL"+(levelInt+1)+"BACKCOLOR"))
		findElementByIJ(i,j).find(".txt").css("color","white")

	}

	function findElementByIJ(i,j){
		return $("table").find("tr").eq(i).find("td").eq(j);
	}
	function showLevel(n){
		switch(n){
			case 0:
				$("#level").text("Level1")
			break;
			case 1:
				$("#level").text("Level2")
			break;
			case 2:
				$("#level").text("Level3")
			break;
			case 3:
				$("#level").text("Level4")
			break;
			case -1:
				$("#level").text("normal")
			break;
			default:
				alert("unknow level");
			break;
		}
	}

	function textManager(txt){
		switch(window.levelInt){
			case 0:
				return "_"+txt
			break;
			case 1:
				return "__"+txt
			break;
			case 2:
				return "@"+txt
			break;
			case 3:
				return "@@"+txt
			break;
			default:
				return txt
			break;
		}
	}

	function dragNumFromtext(txt){
		return /([0-9]+)/.exec(txt)?/([0-9]+)/.exec(txt)[0]:""
	}

	var orderLevelStartArr = [{},{},{},{}];

	function addIntoLevelArr(i,j,txt){
		if(isNaN(window.levelInt) || parseInt(window.levelInt)<0) return;
		var arr = ["level1Arr","level2Arr","level3Arr","level4Arr"]

		cancelOtherArrij(arr,i,j)

		if(!txt){
			eval(arr[window.levelInt])[i][j] = 0
		}else{
			eval(arr[window.levelInt])[i][j] = txt
			if(checkObjEmpty(orderLevelStartArr[window.levelInt])==0){
				orderLevelStartArr[window.levelInt]["i"] = i;
				orderLevelStartArr[window.levelInt]["j"] = j;
			}
		}
	}

	function cancelOtherArrij(arr,i,j){
		var arr = ["level1Arr","level2Arr","level3Arr","level4Arr"]
		for(var k=0;k<arr.length;k++){
			if(window.levelInt == k) continue;
			eval(arr[k])[i][j] = 0;
		}
	}

	function cancelLevelTo(n){
			var arr = ["level1Arr","level2Arr","level3Arr","level4Arr"]
			if(window.levelInt < n){
				alert("illegal");
				return;
			}

			for(var i=window.levelInt;i>n;i--){
				console.log(eval(arr[i]))
				clearCrossNum(eval(arr[i]))
				initalNineArr(eval(arr[i]));
			}
	}

	function initalNineArr(arr){
			for(var i=0;i<arr.length;i++){
				for(var j=0;j<arr[i].length;j++){
					arr[i][j] = 0;
				}
			}
	}

	function clearCrossNum(arr){
			for(var i=0;i<arr.length;i++){
				for(var j=0;j<arr[i].length;j++){
					console.log(arr[i][j])
					if(parseInt(arr[i][j])>0){
						clearCrossNumGo(i,j)
					}
				}
			}
	}

	function clearCrossNumGo(i,j){
			$("table").find("tr").eq(i).find("td").eq(j).find(".txt").text("");
	}


	function initalData(){

		 var initalArr = new Array(9);
		 for(var i=0;i<9;i++){
		 	initalArr[i] = new Array(9)
		 }

		 level1Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level1Arr[i] = new Array(9)
		 }	

 		 level2Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level2Arr[i] = new Array(9)
		 }	 

 		 level3Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level3Arr[i] = new Array(9)
		 }

 		 level4Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level4Arr[i] = new Array(9)
		 }

		initalArr[0][4] = 9
		initalArr[0][8] = 1

		initalArr[1][2] = 4
		initalArr[1][3] = 8	

		initalArr[2][7] = 9	
		initalArr[2][8] = 7	

 		initalArr[3][8] = 2

		initalArr[4][2] = 6	
		initalArr[4][6] = 3	

		initalArr[5][3] = 9	
		initalArr[5][4] = 7

		initalArr[6][0] = 1	
		initalArr[6][1] = 7	

		initalArr[7][3] = 4
		initalArr[7][5] = 6	
		initalArr[7][7] = 8

		initalArr[8][5] = 5

		return initalArr;
	}

	function initalCross(){
		var initalArr = initalData()

		for(var i=0;i<initalArr.length;i++){
				for(var j=0;j<initalArr[i].length;j++){
					if(initalArr[i][j]){
					$("table").find("tr").eq(i).children("td").eq(j).find("input").remove()
					$("table").find("tr").eq(i).children("td").eq(j).html('<span style="color:blue">'+initalArr[i][j]+'</span>')
					}

				}
		}
	}

	initalCross()


	function checkObjEmpty(obj){
		var n = 0;
		for(var i in obj){
			n++;
		}

		return n;
	}


</script>


</html>