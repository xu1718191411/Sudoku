<html>
<head>
	<title>shudu</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">

	tr:{
		border: 1px black solid
	}

	table{
		width:520px;
		 border-collapse:collapse;
	}

	td{
		width: 50px;
		height: 50px;
	}

	table input{
		width:50px;
		height: 30px;
		display: none;
	}

	.boundary-left {
	border-left: 3px #000000 solid;
	}

	.boundary-bottom {
	border-bottom: 3px #000000 solid;
	}

	.txt{

	}


	.candidate {
    display: inline;
    padding: .2em .6em .3em;
    font-size: 75%;
    font-weight: 700;
    line-height: 1;
    color: #fff;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: .25em;
    background-color: #5bc0de;
	}
	</style>


	<script   src="https://code.jquery.com/jquery-2.2.2.min.js"   integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI="   crossorigin="anonymous"></script>


</head>
<body>
<div style="float:left">
<table border="1px" width="500px" height="500px">
<tr line="0">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="1">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>


<tr class="boundary-bottom" line="2">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>


<tr boundary-top line="3">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>



<tr line="4">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr class="boundary-bottom" line="5">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="6">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="7">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

<tr line="8">
	<td num="0" align="center"><span class="txt"></span><input type="text"></td>
	<td num="1" align="center"><span class="txt"></span><input type="text"></td>
	<td num="2" align="center"><span class="txt"></span><input type="text"></td>
	<td num="3" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="4" align="center"><span class="txt"></span><input type="text"></td>
	<td num="5" align="center"><span class="txt"></span><input type="text"></td>
	<td num="6" class="boundary-left" align="center"><span class="txt"></span><input type="text"></td>
	<td num="7" align="center"><span class="txt"></span><input type="text"></td>
	<td num="8" align="center"><span class="txt"></span><input type="text"></td>
</tr>

</table>
</div>

<div style="float:left;width:800px;height:600px;margin:7px;">
	<h3 style="text-align:center">Assumption image</h3>
	<canvas id="canvassample" width="740" height="540"></canvas>
</div>

<div style="clear:both"></div>

<div>
	<p>假设级别<span id="level"></span></p>
</div>
<div>
	<p>
	<button class="level">level1</button>
	<button class="level">level2</button>
	<button class="level">level3</button>
	<button class="level">level4</button>
	<button class="breaklevel">break assumption</button>
	</p>
</div>

<div>
	<p>
	<button class="levelStart">show level1 start point</button>
	<button class="levelPrev">show level1 prev point</button>
	<button class="levelNext">show level1 next point</button>
	<button class="levelEnd">show level1 end point</button>
	<button class="levelHide">hide level1 point</button>
	</p>

	<p>
	<input type="text">
	<button class="addCandidate">add candidate</button>
	<button class="showCandidate">show candidate</button>
	<button class="hideCandidate">hide candidate</button>
	<button class="useCandidate">use current candidate</button>
	<button class="deleteCandidate">delete current candidate</button>
	</p>
</div>

<div>
	<p>
	<button class="levelStart">show level2 start point</button>
	<button class="levelPrev">show level2 prev point</button>
	<button class="levelNext">show level2 next point</button>
	<button class="levelEnd">show level2 end point</button>
	<button class="levelHide">hide level2 point</button>
	</p>

	<p>
	<input type="text">
	<button class="addCandidate">add candidate</button>
	<button class="showCandidate">show candidate</button>
	<button class="hideCandidate">hide candidate</button>
	<button class="useCandidate">use current candidate</button>
	<button class="deleteCandidate">delete current candidate</button>
	</p>

</div>

<div>
	<p>
	<button class="levelStart">show level3 start point</button>
	<button class="levelPrev">show level3 prev point</button>
	<button class="levelNext">show level3 next point</button>
	<button class="levelEnd">show level3 end point</button>
	<button class="levelHide">hide level3 point</button>
	</p>

	<p>
	<input type="text">
	<button class="addCandidate">add candidate</button>
	<button class="showCandidate">show candidate</button>
	<button class="hideCandidate">hide candidate</button>
	<button class="useCandidate">use current candidate</button>
	<button class="deleteCandidate">delete current candidate</button>
	</p>
</div>

<div>
	<p>
	<button class="levelStart">show level4 start point</button>
	<button class="levelPrev">show level4 prev point</button>
	<button class="levelNext">show level4 next point</button>
	<button class="levelEnd">show level4 end point</button>
	<button class="levelHide">hide level4 point</button>
	</p>

	<p>
	<input type="text">
	<button class="addCandidate">add candidate</button>
	<button class="showCandidate">show candidate</button>
	<button class="hideCandidate">hide candidate</button>
	<button class="useCandidate">use current candidate</button>
	<button class="deleteCandidate">delete current candidate</button>
	</p>
</div>

<div>
	<p>
	<button class="hidelevelStart">hide all level start point</button>
	<button class="hidelevelEnd">hide all level end point</button>
	</p>
</div>
</body>

<script type="text/javascript">

startCanvas()

function startCanvas(){
    var l1 = document.getElementById('canvassample');
    var ctx = l1.getContext('2d');

	ctx.fillStyle = "#00FA9A";
	ctx.fillRect(50, 10, 850, 100);

}


</script>


<script type="text/javascript">

	var defaultColor = "blue"
	var defaultBackColor = "white"

	var orderLevelStartArr = [{},{},{},{}];//In the array there exists every level's first element

	var hightLightStatusArr = [-1,-1,-1,-1];//In the array there exists the index of the current highlight cell for each level

	var levelCandidateArr = [[],[],[],[]] //In the array there exists the candidate of each level

	const LEVEL1COLOR = "#ffffff"
	const LEVEL1BACKCOLOR = "#00FA9A"

	const LEVEL2COLOR = "#ffffff"
	const LEVEL2BACKCOLOR = "#9ACD32"

	const LEVEL3COLOR = "#ffffff"
	const LEVEL3BACKCOLOR = "#FFA500"

	const LEVEL4COLOR = "#ffffff"
	const LEVEL4BACKCOLOR = "#000080"

	const CANDIDATECOLOR = "#ffffff"
	const CANDIDATEBACKCOLOR = "#7f7f7f"

	$("td").click(function(){
		$(this).find("input").show()
		$(this).find(".txt").hide()

		var txt = $(this).find(".txt").html()
		$(this).find("input").val(dragNumFromtext(txt))
		$(this).find("input").focus()
	})

	$("table input").change(function(){
			var txt = $(this).val()
			if(/[1-9]/.exec(txt) || !txt){
				
			}else{
				return false;
			}
			addIntoLevelArr($(this).parents("tr").index(),$(this).parents("td").index(),txt)
			addIntoLevelOrderArr($(this).parents("tr").index(),$(this).parents("td").index(),txt)
			$(this).siblings(".txt").text(textManagerByLevel(txt,window.levelInt))
			$(this).siblings(".txt").show()
			$(this).hide()
			$(this).val("")
	})

	$("table input").blur(function(){
			$(this).hide()
			$(this).siblings(".txt").show()
	})

	$(".level").click(function(){
		var levelInt = parseInt($(this).index())

		if(!checklevelJump(levelInt)) return false;

		window.levelInt = levelInt
		showLevel(levelInt)
	})

	$(".levelStart").click(function(){
		var levelInt = parseInt($(".levelStart").index(this))
		//var i = orderLevelStartArr[levelInt]["i"]
		//var j = orderLevelStartArr[levelInt]["j"]

		if(!eval("level"+(levelInt+1)+"OrderArr")[0]){
			return false;
		}

		//var i = eval("level"+(levelInt+1)+"OrderArr")[0]["i"];
		//var j = eval("level"+(levelInt+1)+"OrderArr")[0]["j"];


		var i = findCurrentFirstOrderCell(levelInt)["i"]
		var j = findCurrentFirstOrderCell(levelInt)["j"]

		findElementByIJ(i,j).find(".txt").text(textManagerByLevel(eval("level"+(levelInt+1)+"OrderArr")[0]['text'],levelInt))

		hightLightStatusArr[levelInt] = 0

		if(parseInt(i)>=0 && parseInt(j)>=0 ){
			showStartPoint(i,j,levelInt)
		}

		//去除其他的highLight
		for(j=eval("level"+(levelInt+1)+"OrderArr").length - 1;j>0;j--){
			var obj = eval("level"+(levelInt+1)+"OrderArr")[j];		
			hideHightLightByIJ(obj["i"],obj["j"])
		}

	})

	$(".levelEnd").click(function(){
		var levelInt = parseInt($(".levelEnd").index(this))
		if(!eval("level"+(levelInt+1)+"OrderArr").slice(-1)[0]){
			return false;
		}

		hightLightStatusArr[levelInt] = eval("level"+(levelInt+1)+"OrderArr").length - 1

		var i = eval("level"+(levelInt+1)+"OrderArr").slice(-1)[0]["i"];
		var j = eval("level"+(levelInt+1)+"OrderArr").slice(-1)[0]["j"];

		if(parseInt(i)>=0 && parseInt(j)>=0 ){
			showStartPoint(i,j,levelInt)
		}

		for(var j=0;j<eval("level"+(levelInt+1)+"OrderArr").length - 1;j++){
			var obj = eval("level"+(levelInt+1)+"OrderArr")[j];
			hideHightLightByIJ(obj["i"],obj["j"])
		}

	})

	$(".levelHide").click(function(){
		var levelInt = parseInt($(".levelHide").index(this))

		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]

		if(eval(arr[levelInt]).length == 0) return false;
		if(hightLightStatusArr[levelInt] == -1) return false;

		var _i = eval(arr[levelInt])[hightLightStatusArr[levelInt]]["i"]
		var _j = eval(arr[levelInt])[hightLightStatusArr[levelInt]]["j"]
		hideHightLightByIJ(_i,_j)

		hightLightStatusArr[levelInt] = -1
	})

	$(".levelNext").click(function(){
		var levelNext = parseInt($(".levelNext").index(this))

		var _k = hightLightStatusArr[levelNext]

		if(eval("level"+(levelNext+1)+"OrderArr").length==0){
			return false;
		}

		//找到最后一个点时就不往后面找了
		if(_k == (eval("level"+(levelNext+1)+"OrderArr").length-1)){
			return false;
		}
		
		//去除前面一格的高亮
		if(_k>-1){
			var _i = eval("level"+(levelNext+1)+"OrderArr")[_k]["i"];
			var _j = eval("level"+(levelNext+1)+"OrderArr")[_k]["j"];
			hideHightLightByIJ(_i,_j)	
		}

		//显示后面一格的高亮
		var k = hightLightStatusArr[levelNext] + 1

		if(!eval("level"+(levelNext+1)+"OrderArr")[k]){
			return false;
		}

		var i = eval("level"+(levelNext+1)+"OrderArr")[k]["i"];
		var j = eval("level"+(levelNext+1)+"OrderArr")[k]["j"];

		showStartPoint(i,j,levelNext)
		hightLightStatusArr[levelNext] += 1

	})

	$(".levelPrev").click(function(){
		var levelPrev = parseInt($(".levelPrev").index(this))

		var _k = hightLightStatusArr[levelPrev]
		

		if(eval("level"+(levelPrev+1)+"OrderArr").length==0){
			return false;
		}


		//找到第一个点时就不能往前找了
		if(_k == 0){
			return false;
		}


		//去除后面一格的高亮
		if(_k>-1){
			var _i = eval("level"+(levelPrev+1)+"OrderArr")[_k]["i"];
			var _j = eval("level"+(levelPrev+1)+"OrderArr")[_k]["j"];
			hideHightLightByIJ(_i,_j)	
		}

		//显示前面一格的高亮
		var k = hightLightStatusArr[levelPrev] - 1

		if(!eval("level"+(levelPrev+1)+"OrderArr")[k]){
			return false;
		}

		var i = eval("level"+(levelPrev+1)+"OrderArr")[k]["i"];
		var j = eval("level"+(levelPrev+1)+"OrderArr")[k]["j"];

		showStartPoint(i,j,levelPrev)
		hightLightStatusArr[levelPrev] -= 1

	})

	$(".addCandidate").click(function(){
		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]
		var levelCandidate = $(".addCandidate").index(this);
		if(eval(arr[levelCandidate]).length<=0){
			return false;
		}

		var val = $(this).prev("input").val()

		if(!/[1-9]/.exec(val)){
			return false;
		}

		//如果计划加入的candidate与该level的第一个数相同的话，则什么也不发生
		if(firstFirstOrderNum(levelCandidate) == val){
			return false;
		}
		if(!addIntoArrayWithOutDuplicate(val,levelCandidateArr[levelCandidate])) return false;

		$(this).siblings(".showCandidate").after("<span class='candidate'>"+val+"</span>&nbsp;")
		$(".levelStart").eq(levelCandidate).click()

		//清除表单
		$(this).prev("input").val("")
	})


	jQuery(document).on("click",".candidate",function(){
		var levelCandidate = $(".addCandidate").index($(this).siblings(".addCandidate"));
		var val = $(this).text()
		removeParticularElementFromArray(val,levelCandidateArr[levelCandidate])

		//如果该级别下第一个单元格显示的是目前即将删除的candidate的话，那么将第一个单元格的内容重新设置为levelnOrderArr[0]['text']
		if(/[1-9]/.exec(firstFirstOrderNum(levelCandidate))[0] == val){
			recoverFirstCell(levelCandidate)
		}

		$(this).remove()
	})

	$(".showCandidate").click(function(){
		var levelCandidate = $(".showCandidate").index(this);
		if(levelCandidateArr[levelCandidate].length<=0){
			return false;
		}

		for(var i=0;i<levelCandidateArr[levelCandidate].length;i++){
			//alert(levelCandidateArr[levelCandidate][i])
		}

		if(!eval("level"+(levelInt+1)+"OrderArr")[0]){
			return false;
		}

		var i = findCurrentFirstOrderCell(levelCandidate)["i"]
		var j = findCurrentFirstOrderCell(levelCandidate)["j"]

		console.log(findElementByIJ(i,j))
		var element = findElementByIJ(i,j)
		element.css("background-color",CANDIDATEBACKCOLOR)

		if(!/[1-9]/.exec(element.find(".txt").text())){
			return false;
		}

		if(/[1-9]/.exec(element.find(".txt").text())[0] == eval("level"+(levelCandidate+1)+"OrderArr")[0]["text"]){
			//证明此时显示的是正常的第一个数据而不是candidate数据
			element.find(".txt").text(levelCandidateArr[levelCandidate][0])
			
		}else{
			var index = findIndexFromArray(/[1-9]/.exec(element.find(".txt").text())[0],levelCandidateArr[levelCandidate])
			element.find(".txt").text(levelCandidateArr[levelCandidate][(index+1)%levelCandidateArr[levelCandidate].length])
			//证明此时显示的不是正常的第一个数据而是candidate数据，根据现有的candidate数据判断下一个candidate数据该怎样显示
			
		}

	})

	$(".hideCandidate").click(function(){
		var levelCandidate = $(".hideCandidate").index(this);
		//如果没有设置该级别的假设的话则不触发
		if(levelCandidateArr[levelCandidate].length<=0){
			return false;
		}

		//如果该级别下第一个单元格没有数据的话则不触发

		if(!eval("level"+(levelCandidate+1)+"OrderArr")[0]){
			return false;
		}


				recoverFirstCell(levelCandidate)

		// var i = findCurrentFirstOrderCell(levelCandidate)["i"]
		// var j = findCurrentFirstOrderCell(levelCandidate)["j"]
		// var element = findElementByIJ(i,j)


		// if(!(eval("level"+(levelCandidate+1)+"OrderArr")[0]["text"] == /[1-9]/.exec(element.find(".txt").text())[0])){
		// 	//证明此时显示的不是正常的第一个数据而是candidate数据，根据现有的candidate数据判断下一个candidate数据该怎样显示
				


		// 	element.find(".txt").text(textManagerByLevel(eval("level"+(levelCandidate+1)+"OrderArr")[0]["text"],levelCandidate))
		// 	element.css("background-color",eval("LEVEL"+(levelCandidate+1)+"BACKCOLOR"))
		// 	element.find(".txt").css("color",eval("LEVEL"+(levelCandidate+1)+"COLOR"))
		// }
		


	})


	function recoverFirstCell(level){
		var i = findCurrentFirstOrderCell(level)["i"]
		var j = findCurrentFirstOrderCell(level)["j"]
		var element = findElementByIJ(i,j)
				
		if(!(eval("level"+(level+1)+"OrderArr")[0]["text"] == /[1-9]/.exec(element.find(".txt").text())[0])){
			//证明此时显示的不是正常的第一个数据而是candidate数据，根据现有的candidate数据判断下一个candidate数据该怎样显示
				
			element.find(".txt").text(textManagerByLevel(eval("level"+(level+1)+"OrderArr")[0]["text"],level))
			element.css("background-color",eval("LEVEL"+(level+1)+"BACKCOLOR"))
			element.find(".txt").css("color",eval("LEVEL"+(level+1)+"COLOR"))
		}

	}

	$(".deleteCandidate").click(function(){
		var levelCandidate = $(".deleteCandidate").index(this);

		//如果当前状态第一个单元格显示的不是candidate的话
		if(firstFirstOrderNum(levelCandidate) == eval("level"+(levelCandidate+1)+"OrderArr")[0]["text"]){
			return false;
		}

		//删除标签中的candidate
			var obj = $($(this).parents("p")[0]).find(".candidate")
			for(var i=0;i<obj.length;i++){
				if($(obj[i]).text()!=firstFirstOrderNum(levelCandidate)) continue;
				$($(this).parents("p")[0]).find(".candidate").eq(i).click()
			}

		//再让希望删除的candidate从灰色方格中删除掉
		for(var i=0;i<levelCandidateArr[levelCandidate].length;i++){
			if(levelCandidateArr[levelCandidate][i] == firstFirstOrderNum(levelCandidate)){
				levelCandidateArr[levelCandidate].splice(i,1)
			}
		}

		//如果所有的candidate都被删掉了的话，那么就显示原始状态下的第一格
		if(levelCandidateArr[levelCandidate].length<1){
			$(".levelStart").eq(levelCandidate).click()
		}

		$(".showCandidate").eq(levelCandidate).click()



	})

	$(".useCandidate").click(function(){
		var levelCandidate = $(".useCandidate").index(this);
		if(levelCandidateArr[levelCandidate].length<=0){
			return false;
		}

		//如果当前状态第一个单元格显示的不是candidate的话
		if(firstFirstOrderNum(levelCandidate) == eval("level"+(levelCandidate+1)+"OrderArr")[0]["text"]){
			return false;
		}

		//先清除比当前级别大的级别的假设
			
			if(!checklevelJump(levelCandidate)) return false;

			window.levelInt = levelCandidate

		//再把当前的candidate加到levelnOrderArr[0]['text']中
			eval("level"+(levelCandidate+1)+"OrderArr")[0]["text"] = firstFirstOrderNum(levelCandidate)

		//再把candidate[n]中的要用的对应的candidate删掉

			var index = findIndexFromArray(firstFirstOrderNum(levelCandidate),levelCandidateArr[levelCandidate])

			levelCandidateArr[levelCandidate].splice(index,1)

		//点击显示当前级别第一格按钮
			$(".levelStart").eq(levelCandidate).click()

		//删除标签中的candidate
			var obj = $($(this).parents("p")[0]).find(".candidate")
			for(var i=0;i<obj.length;i++){
				if($(obj[i]).text()!=firstFirstOrderNum(levelCandidate)) continue;
				$($(this).parents("p")[0]).find(".candidate").eq(i).click()
			}

		//删除该级别除了第一个以外的其他假设

		deleteCertainLevelExcepTheFirst(levelCandidate)

	})

	function deleteCertainLevelExcepTheFirst(level){

		//处理时间序列
		//留首元素去掉之后的元素
		eval("level"+(level+1)+"OrderArr").splice(1,eval("level"+(level+1)+"OrderArr").length-1)

		//处理空间序列
		var _i = eval("level"+(level+1)+"OrderArr")[0]["i"]
		var _j = eval("level"+(level+1)+"OrderArr")[0]["j"]
		var _txt = eval("level"+(level+1)+"OrderArr")[0]['text']


		var tmpArr = eval("level"+(level+1)+"Arr")
		tmpArr[_i][_j] = 0;
		//去除次级别下空间区域中出了第一块方格以外的其他方格
		clearCrossNum(tmpArr)


		for(var i=0;i<eval("level"+(level+1)+"Arr").length;i++){
			eval("level"+(level+1)+"Arr")[i] = new Array(9)
			if(i==_i){
				eval("level"+(level+1)+"Arr["+_i+"][_j]= "+_txt)
			}
		}

	}


	function findCurrentFirstOrderCell(level){
		var i = eval("level"+(level+1)+"OrderArr")[0]["i"];
		var j = eval("level"+(level+1)+"OrderArr")[0]["j"];

		return {"i":i,"j":j}
	}

	function firstFirstOrderNum(level){
		var obj = findCurrentFirstOrderCell(level)
		var i = obj['i']
		var j = obj['j']
		var txt = findElementByIJ(i,j).find(".txt").text()
		return /[1-9]/.exec(txt)[0]
	}


	//add a element into One-dimensional　array
	function addIntoArrayWithOutDuplicate(j,arr){
			for(var i=0;i<arr.length;i++){
				if(arr[i] == j) return false;
			}

			arr.push(j)
			return true;
	}

	//remove a particular element from a array
	function removeParticularElementFromArray(j,arr){
			var index = findIndexFromArray(j,arr)
			if(index<0) return false;

				console.log("index is "+index)
			arr.splice(index,1)

	}

	//find the index of a particular element in a array
	function findIndexFromArray(j,arr){

			for(var i=0;i<arr.length;i++){
					if(arr[i] == j) return i;
			}

			return -1;
	}


	function hideHightLightByIJ(i,j){
			findElementByIJ(i,j).css("background",defaultBackColor)
			findElementByIJ(i,j).find(".txt").css("color",defaultColor)
	}

	$(".hidelevelStart").click(function(){

		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]

		for(var i=0;i<arr.length;i++){
			if(hightLightStatusArr[i]==0){
				var _i = eval(arr[i])[0]["i"]
				var _j = eval(arr[i])[0]["j"]
				hideHightLightByIJ(_i,_j)
				hightLightStatusArr[i] = -1
			}
		}
	})


	$(".hidelevelEnd").click(function(){
		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]

		for(var i=0;i<arr.length;i++){
			if(eval(arr[i]).length==0) continue;
			if(hightLightStatusArr[i]==(eval(arr[i]).length-1)){
				var _i = eval(arr[i]).slice(-1)[0]["i"]
				var _j = eval(arr[i]).slice(-1)[0]["j"]
				hideHightLightByIJ(_i,_j)
				hightLightStatusArr[i] = -1
			}
		}
	})


	$(".breaklevel").click(function(){
		cancelLevelTo(-1)
		showLevel(-1)

		clearAllHightLight()


		 level1OrderArr =  new Array();

 		 level2OrderArr =  new Array();

 		 level3OrderArr =  new Array();

 		 level4OrderArr =  new Array();
		
		 hightLightStatusArr = [-1,-1,-1,-1];
		 
		 delete window.levelInt
	})

	function clearAllHightLight(){
		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]


		for(var i=0;i<hightLightStatusArr.length;i++){
			if(hightLightStatusArr[i]>-1){
				var _i = eval(arr[i])[hightLightStatusArr[i]]["i"]
				var _j = eval(arr[i])[hightLightStatusArr[i]]["j"]

				hideHightLightByIJ(_i,_j)
			}
		}
	}


	function checklevelJump(levelInt){

		if(isNaN(window.levelInt) && levelInt>0){
			alert("you jump to much.");
			return false;
		}

		if(levelInt - window.levelInt>1){
			alert("you jump to much.");
			return false;
		}


		if(levelInt<window.levelInt){
			var confirm = window.confirm("level is now in "+window.levelInt+" if you want to go to level "+levelInt+" you should cancel the level that is larger that "+levelInt)

			if(confirm){
				removeUpperLevelCandidateLabelsFrom(levelInt)
				cancelCandidateArrTo(levelInt)
				cancelLevelTo(levelInt)
				cancelHightLightStatusArrTo(levelInt)
				cancelOrderLevelTo(levelInt)

				
				return true;
			}else{
				return false;
			}

		}

		return true;

	}


	/*
	This function shows the hightlight of every level's first element
	*/
	function showStartPoint(i,j,levelInt){

		findElementByIJ(i,j).css("background",eval("LEVEL"+(levelInt+1)+"BACKCOLOR"))
		findElementByIJ(i,j).find(".txt").css("color","white")

	}


	/*
	This function returns the precisely element by giving the particular coordinate of i and j
	*/
	function findElementByIJ(i,j){
		return $("table").find("tr").eq(i).find("td").eq(j);
	}

	/*
	This function can be used to show which assumption level you are in by giving the particular level Int number
	*/
	function showLevel(n){
		switch(n){
			case 0:
				$("#level").text("Level1")
			break;
			case 1:
				$("#level").text("Level2")
			break;
			case 2:
				$("#level").text("Level3")
			break;
			case 3:
				$("#level").text("Level4")
			break;
			case -1:
				$("#level").text("normal")
			break;
			default:
				alert("unknow level");
			break;
		}
	}

	/*
	This function will return the applicable text according to the level status when you are doing the input
	*/

	function textManagerByLevel(txt,levelN){
			if(!txt){
				return "";
			}
			switch(levelN){
				case 0:
					return "_"+txt
				break;
				case 1:
					return "__"+txt
				break;
				case 2:
					return "@"+txt
				break;
				case 3:
					return "@@"+txt
				break;
				default:
					return txt
				break;
			}
		}
	/*
		
	*/
	function dragNumFromtext(txt){
		return /([0-9]+)/.exec(txt)?/([0-9]+)/.exec(txt)[0]:""
	}


	/*
	levelArray 空间序列
	*/
	function addIntoLevelArr(i,j,txt){
		if(isNaN(window.levelInt) || parseInt(window.levelInt)<0) return;
		var arr = ["level1Arr","level2Arr","level3Arr","level4Arr"]

		cancelOtherArrij(arr,i,j)

		if(!txt){
			eval(arr[window.levelInt])[i][j] = 0
		}else{
			eval(arr[window.levelInt])[i][j] = txt
			if(checkObjEmpty(orderLevelStartArr[window.levelInt])==0){
				orderLevelStartArr[window.levelInt]["i"] = i;
				orderLevelStartArr[window.levelInt]["j"] = j;
			}
		}
	}

	/*
	levelArray 时间序列
	*/

	function addIntoLevelOrderArr(i,j,txt){
		if(isNaN(window.levelInt) || parseInt(window.levelInt)<0) return;

		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]

		cancelOtherOrderArrij(arr,i,j)
		checkIJAlreadyExist(i,j)
		if(!txt){
			
		}else{
			eval(arr[window.levelInt]).push({"i":i,"j":j,"text":txt})
		}

	}

	function checkIJAlreadyExist(i,j){
		if(isNaN(window.levelInt) || parseInt(window.levelInt)<0) return;
		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]

		for(var s=0;s<eval(arr[window.levelInt]).length;s++){
				if(eval(arr[window.levelInt])[s].i == i && eval(arr[window.levelInt])[s].j == j){
					eval(arr[window.levelInt]).splice(s,1)
					return true;
				}
		}

		return false;
	}




	function cancelOtherArrij(arr,i,j){
		var arr = ["level1Arr","level2Arr","level3Arr","level4Arr"]
		for(var k=0;k<arr.length;k++){
			if(window.levelInt == k) continue;
			eval(arr[k])[i][j] = 0;
		}
	}

	function cancelOtherOrderArrij(arr,i,j){
		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]
		for(var k=0;k<arr.length;k++){
			if(window.levelInt == k) continue;
			for(var s=0;s<eval(arr[k]).length;s++){
				if(eval(arr[k])[s].i == i && eval(arr[k])[s].j == j){
					eval(arr[k]).splice(s,1);
				}
			}
		}
	}

	function cancelLevelTo(n){
			var arr = ["level1Arr","level2Arr","level3Arr","level4Arr"]
			if(window.levelInt < n){
				alert("illegal");
				return;
			}

			for(var i=window.levelInt;i>n;i--){
				console.log(eval(arr[i]))
				clearCrossNum(eval(arr[i]))
				initalNineArr(eval(arr[i]));
			}
	}


	function cancelOrderLevelTo(n){
			var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]
			if(window.levelInt < n){
				alert("illegal");
				return;
			}

			for(var i=window.levelInt;i>n;i--){
				//eval(arr[i]) = []
				initialArray(arr[i])
			}
	}

	function cancelCandidateArrTo(n){
		for(var i=3;i>n;i--){
			levelCandidateArr[i] = []
		}
	}

	function removeUpperLevelCandidateLabelsFrom(n){
		var num = 0;
		for(var i=0;i<=n;i++){
			num += levelCandidateArr[i].length
		}

		for(var j=$(".candidate").length-1;j>(num-1);j--){
			$($(".candidate")[j]).click()
		}
	}

	function cancelHightLightStatusArrTo(n){
		var arr = ["level1OrderArr","level2OrderArr","level3OrderArr","level4OrderArr"]
		for(var i=n+1;i<=3;i++){
			if(eval(arr[i]).length<=0) continue;
				
			if(hightLightStatusArr[i]<0) continue;
				var _i = eval(arr[i])[hightLightStatusArr[i]]["i"]
				var _j = eval(arr[i])[hightLightStatusArr[i]]["j"]
				hideHightLightByIJ(_i,_j);
			hightLightStatusArr[i] = -1;
		}
		
	}

	function initialArray(s){
			eval(s + " = new Array()")
	}

	function initalNineArr(arr){
			for(var i=0;i<arr.length;i++){
				for(var j=0;j<arr[i].length;j++){
					arr[i][j] = 0;
				}
			}
	}

	function clearCrossNum(arr){
			for(var i=0;i<arr.length;i++){
				for(var j=0;j<arr[i].length;j++){
					console.log(arr[i][j])
					if(parseInt(arr[i][j])>0){
						clearCrossNumGo(i,j)
					}
				}
			}
	}

	function clearCrossNumGo(i,j){
			$("table").find("tr").eq(i).find("td").eq(j).find(".txt").text("");
	}


	function initalData(){

		 var initalArr = new Array(9);
		 for(var i=0;i<9;i++){
		 	initalArr[i] = new Array(9)
		 }

		 level1Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level1Arr[i] = new Array(9)
		 }	

 		 level2Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level2Arr[i] = new Array(9)
		 }	 

 		 level3Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level3Arr[i] = new Array(9)
		 }

 		 level4Arr =  new Array(9);
		 for(var i=0;i<9;i++){
		 	level4Arr[i] = new Array(9)
		 }

		 level1OrderArr =  new Array();

 		 level2OrderArr =  new Array();

 		 level3OrderArr =  new Array();

 		 level4OrderArr =  new Array();

		initalArr[0][4] = 9
		initalArr[0][8] = 1

		initalArr[1][2] = 4
		initalArr[1][3] = 8	

		initalArr[2][7] = 9	
		initalArr[2][8] = 7	

 		initalArr[3][8] = 2

		initalArr[4][2] = 6	
		initalArr[4][6] = 3	

		initalArr[5][3] = 9	
		initalArr[5][4] = 7

		initalArr[6][0] = 1	
		initalArr[6][1] = 7	

		initalArr[7][3] = 4
		initalArr[7][5] = 6	
		initalArr[7][7] = 8

		initalArr[8][5] = 5

		return initalArr;
	}

	function initalCross(){
		var initalArr = initalData()

		for(var i=0;i<initalArr.length;i++){
				for(var j=0;j<initalArr[i].length;j++){
					if(initalArr[i][j]){
					$("table").find("tr").eq(i).children("td").eq(j).find("input").remove()
					$("table").find("tr").eq(i).children("td").eq(j).html('<span style="color:blue">'+initalArr[i][j]+'</span>')
					}

				}
		}
	}

	initalCross()


	function checkObjEmpty(obj){
		var n = 0;
		for(var i in obj){
			n++;
		}

		return n;
	}


</script>


</html>